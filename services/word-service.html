<link rel="import" href="../../bower_components/polymer/polymer.html"><link rel="import" href="../../bower_components/core-ajax/core-ajax.html"><dom-module id="word-service"><style>
  core-ajax {
    display: none;
  }
  </style><template><core-ajax id="wajax" auto="" verbose="" url="{{jsonUrl}}" handleas="json" on-response="wordsLoaded"></core-ajax></template></dom-module><script>
(function() {
  Polymer({
    is: 'word-service',

    properties: {
      currlang: {
        type: String,
        notify: true,
      },
      warray: {
        type: Array,
        notify: true,
        value: function () { return []; }
      },
      jsonUrl: {
        type: String,
        computed: 'createJsonUrl(currlang)'
      }
    },
    listeners: {
      'change-language': 'changeJsonUrl'
    },
    ready: function() {
    },
    changeJsonUrl: function(ev) {
      console.log("change-language heard by word-service");
    },
    createJsonUrl: function(langCode) {
      //console.log("createJsonUrl: " + langCode);
      if(langCode == undefined) {
        return "/api/ar/top-100.json";
      } else {
        return "/api/"+langCode+"/top-100.json";
      }
    },
    wordsLoaded: function() {
      var jsonSuccess = (this.$.wajax.lastResponse != null) ? true : false;
      console.log("loading words from url: " + this.jsonUrl + " \nSuccess: " + jsonSuccess);
      // Make a copy of the loaded data
      if(jsonSuccess) {
        var ajaxData = this.$.wajax.lastResponse;
        this.warray = ajaxData;
        this.fire('new-words');
      }
    }
  });
})();
</script>